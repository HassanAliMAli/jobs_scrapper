{% extends "base.html" %}

{% block title %}Jobs - PakJobs Aggregator{% endblock %}

{% block content %}
<div class="px-4 py-6 sm:px-0">
    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Job Listings</h1>
        <p class="text-gray-600">{{ "{:,}".format(total_results) }} jobs found</p>
    </div>

    <!-- Search and Filters -->
    <div class="bg-white shadow rounded-lg p-6 mb-6">
        <form method="GET" action="/jobs" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                <input type="text" name="q" value="{{ filters.q }}" 
                       placeholder="Job title, skills, company..."
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                <select name="city" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="">All Cities</option>
                    {% for city in cities %}
                    <option value="{{ city.city }}" {% if filters.city == city.city %}selected{% endif %}>
                        {{ city.city }} ({{ city.count }})
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Site</label>
                <select name="site" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="">All Sites</option>
                    <option value="rozee" {% if filters.site == 'rozee' %}selected{% endif %}>Rozee.pk</option>
                    <option value="mustakbil" {% if filters.site == 'mustakbil' %}selected{% endif %}>Mustakbil</option>
                    <option value="indeed" {% if filters.site == 'indeed' %}selected{% endif %}>Indeed</option>
                    <option value="brightspyre" {% if filters.site == 'brightspyre' %}selected{% endif %}>BrightSpyre</option>
                    <option value="bayt" {% if filters.site == 'bayt' %}selected{% endif %}>Bayt</option>
                    <option value="jobz" {% if filters.site == 'jobz' %}selected{% endif %}>Jobz.pk</option>
                    <option value="bayrozgar" {% if filters.site == 'bayrozgar' %}selected{% endif %}>Bayrozgar</option>
                    <option value="jobsalert" {% if filters.site == 'jobsalert' %}selected{% endif %}>JobsAlert</option>
                    <option value="pakpositions" {% if filters.site == 'pakpositions' %}selected{% endif %}>PakPositions</option>
                </select>
            </div>
            
            <div class="flex items-end">
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md transition">
                    Search
                </button>
            </div>
        </form>
    </div>

    <!-- Job Listings -->
    <div class="space-y-4 mb-6">
        {% for job in jobs %}
        <div class="bg-white shadow rounded-lg p-6 hover:shadow-lg transition">
            <div class="flex justify-between items-start">
                <div class="flex-1">
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">
                        {{ job.title }}
                    </h3>
                    <p class="text-lg text-gray-700 mb-2">
                        {{ job.company }}
                    </p>
                    <div class="flex flex-wrap gap-3 mb-3">
                        {% if job.location %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800">
                            üìç {{ job.location }}
                        </span>
                        {% endif %}
                        
                        {% if job.salary_text %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                            üí∞ {{ job.salary_text }}
                        </span>
                        {% elif job.salary_min %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                            üí∞ PKR {{ "{:,}".format(job.salary_min) }} - {{ "{:,}".format(job.salary_max) if job.salary_max else '?' }}
                        </span>
                        {% endif %}
                        
                        {% if job.job_type %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-purple-100 text-purple-800">
                            {{ job.job_type }}
                        </span>
                        {% endif %}
                        
                        {% if job.is_remote %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-800">
                            üè† Remote
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="text-sm text-gray-500">
                        Posted: {{ job.posted_date.strftime('%Y-%m-%d') if job.posted_date else 'N/A' }} | 
                        Source: <span class="capitalize font-medium">{{ job.site_source }}</span>
                    </div>
                </div>
                
                <div class="ml-4">
                    <a href="{{ job.source_url }}" target="_blank" 
                       class="inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md transition">
                        View Job ‚Üí
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="flex justify-center">
        <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
            {% if page > 1 %}
            <a href="?page={{ page - 1 }}&q={{ filters.q }}&city={{ filters.city }}&site={{ filters.site }}" 
               class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                Previous
            </a>
            {% endif %}
            
            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-indigo-600 text-sm font-medium text-white">
                    {{ p }}
                </span>
                {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                <a href="?page={{ p }}&q={{ filters.q }}&city={{ filters.city }}&site={{ filters.site }}" 
                   class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                    {{ p }}
                </a>
                {% elif p == page - 3 or p == page + 3 %}
                <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                    ...
                </span>
                {% endif %}
            {% endfor %}
            
            {% if page < total_pages %}
            <a href="?page={{ page + 1 }}&q={{ filters.q }}&city={{ filters.city }}&site={{ filters.site }}" 
               class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                Next
            </a>
            {% endif %}
        </nav>
    </div>
    {% endif %}
</div>
{% endblock %}
